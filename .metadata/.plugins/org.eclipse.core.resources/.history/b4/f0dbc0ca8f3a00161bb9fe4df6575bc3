package graphics;

import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.GridLayout;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JOptionPane;

/**
 * The Mine Sweeper Game.
 * Left-click to reveal a cell.
 * Right-click to plant/remove a flag for marking a suspected mine.
 * You win if all the cells not containing mines are revealed.
 * You lose if you reveal a cell containing a mine.
 */
public class MineSweeper extends JFrame {
	private static final long serialVersionUID = 1L;

	// Name-constants for the game properties
	public static final int ROWS = 10;
	public static final int COLS = 10;

	// Name-constants for UI control (sizes, colors and fonts)
	public static final int CELL_SIZE = 60; // Cell width and height, in pixels
	public static final int CANVAS_WIDTH = CELL_SIZE * COLS; // Game board width/heigh
	public static final int CANVAS_HEIGH = CELL_SIZE * ROWS;
	public static final Color BGCOLOR_NOT_REVEALED = Color.GREEN;
	public static final Color FGCOLOR_NOT_REVEALED = Color.RED; // flag
	public static final Color BGCOLOR_REVEALED = Color.DARK_GRAY;
	public static final Color FGCOLOR_REVEALED = Color.LIGHT_GRAY; // number of mines
	public static final Font FONT_NUMBERS = new Font("Monospaced", Font.BOLD, 20);

	// Buttons for user interaction
	JButton[][] btnCells = new JButton[ROWS][COLS];

	// Number of mines in this game. Can vary to control the difficulty level.
	int numMines;

	// Location of mines. True if mine is present on this cell.
	boolean[][] mines = new boolean[ROWS][COLS];

	// User can right-click to plant/remove a flag to mark a suspicious cell
	boolean[][] flags = new boolean[ROWS][COLS];

	/**
	  * Constructor to setup the game and the UI Components
	  */
	public MineSweeper() {
		Container container = this.getContentPane();
		container.setLayout(new GridLayout(ROWS, COLS, 2, 2));

		CellMouseListener listener = new CellMouseListener();
		// Construct 10x10 JButtons and add to the content-pane
		for (int row = 0; row < ROWS; row++) {
			for (int col = 0; col < COLS; col++) {
				btnCells[row][col] = new JButton();
				btnCells[row][col].addMouseListener(listener);
				container.add(btnCells[row][col]);
			}
		}
		container.setPreferredSize(new Dimension(CANVAS_WIDTH, CANVAS_HEIGH));
		pack();
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setTitle("Minesweeper");
		setVisible(true);
		initGame();
	}

	// Initialize and re-initialize a new game
	public void initGame() {
		// Reset cells, mines and flags
		for (int row = 0; row < ROWS; row++) {
			for (int col = 0; col < COLS; col++) {
				// Set all cells to un-revealed
				btnCells[row][col].setEnabled(true);
				btnCells[row][col].setForeground(FGCOLOR_NOT_REVEALED);
				btnCells[row][col].setBackground(BGCOLOR_NOT_REVEALED);
				btnCells[row][col].setFont(FONT_NUMBERS);
				btnCells[row][col].setText(""); // display blank
				mines[row][col] = false; // clear all the mines
				flags[row][col] = false; // clear all the flags
			}
		}

		// Set the number of mines and the mines' location
		// Hardcoded here! Should be randomly generated for each game.
		numMines = 10;
		mines[1][3] = true;
		mines[5][2] = true;
		mines[9][5] = true;
		mines[6][7] = true;
		mines[8][2] = true;
		mines[2][4] = true;
		mines[5][7] = true;
		mines[7][7] = true;
		mines[6][8] = true;
		mines[4][8] = true;
	}

	private class CellMouseListener extends MouseAdapter {

		@Override
		public void mouseClicked(MouseEvent e) {
			// Determine the (row, col) of the JButton that triggered the event
			int rowSelected = -1;
			int colSelected = -1;

			// Get the source object that fired the Event
			JButton source = (JButton) e.getSource();
			// Scan all rows and columns and match with the source object
			boolean found = false;
			for (int row = 0; row < ROWS && !found; row++) {
				for (int col = 0; col < COLS && !found; col++) {
					if (source == btnCells[row][col]) {
						rowSelected = row;
						colSelected = col;
						found = true;
					}
				}
			}

			// Left-click to reveal a cell; Right-click to plant/remove the flag.
			if (e.getButton() == MouseEvent.BUTTON1) {// Left-button clicked
				if (mines[rowSelected][colSelected]) {
					btnCells[rowSelected][colSelected].setBackground(FGCOLOR_NOT_REVEALED);
					JOptionPane.showMessageDialog(MineSweeper.this, "Game Over", "Notification",
							JOptionPane.INFORMATION_MESSAGE);
					initGame();
				} else {
					btnCells[rowSelected][colSelected].setBackground(BGCOLOR_REVEALED);
					btnCells[rowSelected][colSelected].setForeground(FGCOLOR_REVEALED);
					btnCells[rowSelected][colSelected].setText("1");
					btnCells[rowSelected][colSelected].setFocusable(false);
				}
			} else if (e.getButton() == MouseEvent.BUTTON3) { // Right-button clicked
				if (flags[rowSelected][colSelected]) {
					flags[rowSelected][colSelected] = false;
					btnCells[rowSelected][colSelected].setBackground(BGCOLOR_NOT_REVEALED);
					btnCells[rowSelected][colSelected].setText("");
					btnCells[rowSelected][colSelected].setFocusable(false);
				} else {
					flags[rowSelected][colSelected] = true;
					btnCells[rowSelected][colSelected].setForeground(FGCOLOR_NOT_REVEALED);
					btnCells[rowSelected][colSelected].setBackground(BGCOLOR_NOT_REVEALED);
					btnCells[rowSelected][colSelected].setText("<");
					btnCells[rowSelected][colSelected].setFocusable(false);
				}
			}
		}
	}

	/**
	 * Launch the application.
	 */
	public static void main(String[] args) {
		new MineSweeper();
	}

}
